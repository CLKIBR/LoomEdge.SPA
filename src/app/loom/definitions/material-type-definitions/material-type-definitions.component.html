<c-container breakpoint="xxl">
    <c-row>
        <c-col>
            <c-card [cBorder]="{top: {color: 'warning', width: 3}}" class="mb-3">
                <c-card-header>
                    <h5 cModalTitle>Malzeme Tip Tanımı</h5>
                </c-card-header>
                <c-card-body class="modal-scrollable">
                    <ng-container *ngTemplateOutlet="MalTypeTbl"></ng-container>
                </c-card-body>
                <c-card-footer>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button cButton color="success" variant="outline" (click)="toggleNewMalTypeModal()">Ekle</button>

                        <button cButton color="warning" variant="outline" (click)="editMalType()"
                            [disabled]="!selectedMalType">
                            Değiştir
                        </button>

                        <button cButton color="danger" variant="outline"
                            (click)="deleteConfirmation(selectedMalType || null)" [disabled]="!selectedMalType">
                            Sil
                        </button>
                    </div>
                </c-card-footer>
            </c-card>
        </c-col>
    </c-row>
</c-container>

<c-modal [(visible)]="isDeleteModalVisible" [backdrop]="true" alignment="center" centered closeable>
    <c-row>
        <c-col>
            <c-card [cBorder]="{top: {color: 'danger', width: 3}}" class="mb-3">
                <c-card-header>
                    <h5 cModalTitle>Silme İşlemi</h5>
                </c-card-header>
                <c-card-body class="modal-scrollable">
                    <p>
                        <strong cTextColor="danger">{{ malTypeToDelete?.name }}</strong> tipini silmek istiyor musunuz?
                    </p>
                </c-card-body>
                <c-card-footer>
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button cButton color="danger" variant="outline" (click)="confirmDelete()">Evet</button>
                        <button cButton color="secondary" variant="outline" (click)="cancelDelete()">Hayır</button>
                    </div>
                </c-card-footer>
            </c-card>
        </c-col>
    </c-row>
</c-modal>

<c-modal [(visible)]="isEditMode" [backdrop]="true" alignment="center" centered closeable>
    <c-row>
      <c-col>
        <c-card [cBorder]="{top: {color: 'primary', width: 3}}" class="mb-3">
          <c-card-header>
            <h5 cModalTitle>Malzeme Tipi Düzenleme</h5>
          </c-card-header>
          <c-card-body class="modal-scrollable">
            <form [formGroup]="malTypeForm">
              <div class="mb-3">
                <label for="name" class="form-label">Tip Adı</label>
                <input type="text" id="name" class="form-control" formControlName="name" />
              </div>
              <div class="mb-3">
                <label for="code" class="form-label">Tip Kodu</label>
                <input type="text" id="code" class="form-control" formControlName="code" />
              </div>
              <div class="mb-3">
                <label for="amount" class="form-label">Kullanım Miktarı</label>
                <input type="number" id="amount" class="form-control" formControlName="amount" />
              </div>
              <div class="mb-3">
                <label for="description" class="form-label">Açıklama</label>
                <textarea id="description" class="form-control" formControlName="description"></textarea>
              </div>
              <div class="mb-3">
                <label for="url" class="form-label">URL</label>
                <input type="text" id="url" class="form-control" formControlName="url" />
              </div>
            </form>
          </c-card-body>
          <c-card-footer>
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <button cButton color="success" variant="outline" (click)="saveChanges()">Kaydet</button>
              <button cButton color="secondary" variant="outline" (click)="isEditMode = false">İptal</button>
            </div>
          </c-card-footer>
        </c-card>
      </c-col>
    </c-row>
  </c-modal>

  <c-modal [(visible)]="visible" [backdrop]="true" alignment="center" centered closeable>
    <c-row>
      <c-col>
        <c-card [cBorder]="{ top: { color: 'primary', width: 3 } }" class="mb-3">
          <c-card-header>
            <h5 cModalTitle>Yeni Malzeme Tipi Ekle</h5>
          </c-card-header>
          <c-card-body class="modal-scrollable">
            <form [formGroup]="malTypeForm">
              <div class="mb-3">
                <label for="name" class="form-label">Tip Adı</label>
                <input type="text" id="name" class="form-control" formControlName="name" />
              </div>
              <div class="mb-3">
                <label for="code" class="form-label">Tip Kodu</label>
                <input type="text" id="code" class="form-control" formControlName="code" />
              </div>
              <div class="mb-3">
                <label for="amount" class="form-label">Kullanım Miktarı</label>
                <input type="number" id="amount" class="form-control" formControlName="amount" />
              </div>
              <div class="mb-3">
                <label for="description" class="form-label">Açıklama</label>
                <textarea id="description" class="form-control" formControlName="description"></textarea>
              </div>
              <div class="mb-3">
                <label for="url" class="form-label">URL</label>
                <input type="text" id="url" class="form-control" formControlName="url" />
              </div>
            </form>
          </c-card-body>
          <c-card-footer>
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
              <button cButton color="success" variant="outline" (click)="saveNewMalType()">Kaydet</button>
              <button cButton color="secondary" variant="outline" (click)="visible = false">İptal</button>
            </div>
          </c-card-footer>
        </c-card>
      </c-col>
    </c-row>
  </c-modal>
  

<ng-template #MalTypeTbl>
    <table [hover]="true" [responsive]="true" [striped]="true" align="middle" cTable class="mb-0 border">
        <thead class="text-nowrap text-truncate">
            <tr>
                <th class="bg-body-tertiary text-center">
                    <svg cIcon name="cilPeople"></svg>
                </th>
                <th class="bg-body-tertiary">Tip Adı</th>
                <th class="bg-body-tertiary text-center">Tip Kodu</th>
                <th class="bg-body-tertiary">Kullanım</th>
                <th class="bg-body-tertiary">Açıklama</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let malType of malTypes; trackBy: trackById"
                [cTableColor]="selectedMalType === malType.id ? 'warning' : ''" (click)="selectMalType(malType)">
                <td class="text-center">
                    <c-avatar [size]="'md'" [src]="malType.url" status="success"></c-avatar>
                </td>
                <td>
                    <div class="fw-semibold">{{ malType.name }}</div>
                    <div class="small text-body-secondary text-nowrap">
                        <span>
                            Ekleme Tarihi: {{ malType.createdDate }}
                        </span>
                    </div>
                </td>
                <td class="text-center fw-semibold">
                    <div>{{ malType.code }}</div>
                </td>
                <td>
                    <div class="d-flex justify-content-between">
                        <div class="float-start">
                            <strong>{{malType.amount}}%</strong>
                        </div>
                        <div class="float-end ms-1 text-nowrap">
                            <small class="text-body-secondary">Depo Kullanım Miktarı</small>
                        </div>
                    </div>
                    <c-progress thin [value]="malType.amount" color="success" aria-label="Usage"></c-progress>
                </td>
                <td>
                    <div class="small text-body-secondary">Kullanımda</div>
                    <div class="text-nowrap">{{ malType.description }}</div>
                </td>
            </tr>
        </tbody>
    </table>
</ng-template>